<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>STARBOUND - EQUAL ODDS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #00f2ff; --red: #ff0044; --gold: #ffcc00; --bg: #010105; --green: #00ff88; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; user-select: none; }
        #gameCanvas { display: block; }

        .hud { position: absolute; top: 20px; left: 20px; pointer-events: none; z-index: 100; background: rgba(0,0,0,0.7); padding: 15px; border: 1px solid rgba(0,242,255,0.3); border-radius: 8px; backdrop-filter: blur(5px); }
        .bar-container { width: 200px; height: 8px; background: rgba(255,255,255,0.05); margin: 5px 0 12px 0; border-radius: 4px; overflow: hidden; }
        #hpFill { height: 100%; width: 100%; background: #aa0000; transition: 0.2s; }
        #shieldFill { height: 100%; width: 100%; background: #0088aa; transition: 0.2s; }
        
        #radar { position: absolute; bottom: 20px; right: 20px; width: 160px; height: 160px; background: rgba(0,0,0,0.8); border: 1px solid rgba(0,242,255,0.2); border-radius: 50%; z-index: 100; }
        #radarCanvas { border-radius: 50%; }

        .screen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(10px); overflow-y: auto; padding: 20px 0; }
        .shop-section { width: 90%; max-width: 900px; margin-bottom: 20px; }
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; width: 100%; }
        
        .card { background: #0a0a0a; border: 1px solid #222; padding: 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; text-align: center; }
        .card:hover { border-color: var(--blue); background: #111; }
        .card.active { border-color: var(--green); background: rgba(0,255,136,0.05); }
        .card.locked { opacity: 0.4; }
        
        .btn { background: var(--blue); color: black; border: none; padding: 12px 40px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; margin-top: 15px; border-radius: 4px; transition: 0.2s; text-transform: uppercase; width: 250px; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--blue); }
        .btn-exit { background: transparent; color: var(--red); border: 2px solid var(--red); margin-top: 10px; }
        .btn-exit:hover { background: var(--red); color: white; box-shadow: 0 0 15px var(--red); }
        
        .instruction { position: absolute; bottom: 20px; left: 20px; font-size: 10px; color: #555; }
        h2 { font-size: 14px; color: var(--blue); letter-spacing: 2px; text-transform: uppercase; border-bottom: 1px solid #222; padding-bottom: 5px; }
    </style>
</head>
<body>

    <div class="hud">
        <div style="font-size: 10px; color: var(--blue);">SHIELD</div>
        <div class="bar-container"><div id="shieldFill"></div></div>
        <div style="font-size: 10px; color: var(--red);">HULL</div>
        <div class="bar-container"><div id="hpFill"></div></div>
        <div style="color: var(--gold); font-size: 18px;">CREDITS: <span id="moneyText">0</span></div>
    </div>

    <div id="radar"><canvas id="radarCanvas" width="160" height="160"></canvas></div>

    <div id="shopScreen" class="screen">
        <h1 style="color:var(--blue); letter-spacing: 5px; margin: 0;">HANGAR TERMINAL</h1>
        
        <div class="shop-section">
            <h2>VERFÜGBARE SCHIFFE</h2>
            <div id="shipGrid" class="shop-grid"></div>
        </div>

        <div class="shop-section">
            <h2>WARTUNG & UPGRADES</h2>
            <div class="shop-grid">
                <div class="card" onclick="buyRepair()">
                    <h3 style="color:var(--green)">Hüllen-Reparatur</h3>
                    <p style="font-size:12px">+40 HP</p>
                    <p style="color:var(--gold)">450 CR</p>
                </div>
                <div class="card" onclick="buyShieldUpgrade()">
                    <h3 style="color:var(--blue)">Schild-Kondensator</h3>
                    <p style="font-size:12px">Regen +15%</p>
                    <p style="color:var(--gold)">2500 CR</p>
                </div>
            </div>
        </div>

        <button class="btn" onclick="toggleShop()">FLUG STARTEN (M)</button>
        <button class="btn btn-exit" onclick="window.location.href='index.html'">Exit to Homepage</button>
    </div>

    <div class="instruction">WASD: BEWEGEN | SPACE: FEUER | M: SHOP</div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const radarCanvas = document.getElementById('radarCanvas');
const rctx = radarCanvas.getContext('2d');

const ships = [
    { id: 0, name: "Scout Mk I", hp: 100, laser: 20, color: "#00f2ff", price: 0, speed: 0.28, laserSize: 3 },
    { id: 1, name: "Viper Edge", hp: 180, laser: 35, color: "#00ff88", price: 3500, speed: 0.26, laserSize: 4 },
    { id: 2, name: "Interceptor", hp: 350, laser: 60, color: "#ffcc00", price: 10000, speed: 0.22, laserSize: 6 },
    { id: 3, name: "Titan Prime", hp: 1000, laser: 150, color: "#ff0044", price: 35000, speed: 0.14, laserSize: 12 }
];

let state = {
    money: 50, 
    hp: 100, maxHp: 100, shield: 100, lastHit: 0,
    shipType: 0, ownedShips: [0],
    rotation: 0, velX: 0, velY: 0,
    worldX: 0, worldY: 0, isPaused: false, lastShot: 0,
    shieldRegenRate: 0.12
};

let keys = {}, asteroids = [], enemies = [], lasers = [], particles = [], stars = [];

function init() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    for(let i=0; i<150; i++) stars.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: Math.random()*1.5, depth: Math.random()*0.5+0.1 });
    for(let i=0; i<30; i++) spawnAsteroid();
    requestAnimationFrame(loop);
}

function spawnAsteroid() {
    const ang = Math.random() * Math.PI * 2;
    const dist = 1000 + Math.random() * 2000;
    asteroids.push({
        x: state.worldX + Math.cos(ang) * dist,
        y: state.worldY + Math.sin(ang) * dist,
        size: 20 + Math.random() * 40,
        hp: 40, type: Math.random() > 0.95 ? 'gold' : 'rock'
    });
}

function spawnEnemy() {
    if(enemies.length < 3) {
        const ang = Math.random() * Math.PI * 2;
        enemies.push({
            x: state.worldX + Math.cos(ang) * 1400,
            y: state.worldY + Math.sin(ang) * 1400,
            hp: 100, maxHp: 100, lastShot: 0, size: 40, laserDmg: 20 
        });
    }
}

function loop() {
    if(!state.isPaused) {
        ctx.fillStyle = '#010105'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawStars();
        updatePhysics();
        drawEntities();
        drawParticles();
        drawPlayer();
        updateRadar();
        updateUI();
        if(Math.random() < 0.03) spawnAsteroid();
        if(Math.random() < 0.004) spawnEnemy();
    }
    requestAnimationFrame(loop);
}

function updatePhysics() {
    const ship = ships[state.shipType];
    if(keys['a']) state.rotation -= 0.06;
    if(keys['d']) state.rotation += 0.06;
    if(keys['w']) {
        state.velX += Math.cos(state.rotation) * ship.speed;
        state.velY += Math.sin(state.rotation) * ship.speed;
    }
    state.velX *= 0.985; state.velY *= 0.985;
    state.worldX += state.velX; state.worldY += state.velY;

    if(Date.now() - state.lastHit > 5000 && state.shield < 100) state.shield += state.shieldRegenRate;

    if(keys[' '] && Date.now() - state.lastShot > 300) {
        lasers.push({ 
            x: canvas.width/2, y: canvas.height/2, 
            vx: Math.cos(state.rotation)*16 + state.velX, 
            vy: Math.sin(state.rotation)*16 + state.velY, 
            life: 70, owner: 'player', 
            size: ship.laserSize, color: ship.color, damage: ship.laser
        });
        state.lastShot = Date.now();
    }
}

function drawPlayer() {
    const ship = ships[state.shipType];
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.rotate(state.rotation);
    ctx.strokeStyle = ship.color; ctx.lineWidth = 3;
    ctx.beginPath(); ctx.moveTo(20, 0); ctx.lineTo(-12, -15); ctx.lineTo(-12, 15); ctx.closePath(); ctx.stroke();
    if(state.shield > 1) {
        ctx.strokeStyle = 'rgba(0, 242, 255, '+ (state.shield/100) +')';
        ctx.beginPath(); ctx.arc(0, 0, 35, 0, Math.PI*2); ctx.stroke();
    }
    ctx.restore();
}

function drawEntities() {
    asteroids.forEach((ast, i) => {
        let sx = ast.x - state.worldX + canvas.width/2;
        let sy = ast.y - state.worldY + canvas.height/2;
        ctx.strokeStyle = ast.type === 'gold' ? 'gold' : '#444';
        ctx.strokeRect(sx-ast.size/2, sy-ast.size/2, ast.size, ast.size);
        lasers.forEach(l => {
            if(l.owner === 'player' && Math.abs(sx-l.x) < ast.size/2 && Math.abs(sy-l.y) < ast.size/2) {
                ast.hp -= l.damage; l.life = 0;
                if(ast.hp <= 0) { 
                    state.money += ast.type === 'gold' ? 250 : 25; 
                    createExplosion(sx, sy, ast.type === 'gold' ? 'gold' : '#444', 10);
                    asteroids.splice(i, 1); 
                }
            }
        });
    });

    enemies.forEach((en, i) => {
        let sx = en.x - state.worldX + canvas.width/2;
        let sy = en.y - state.worldY + canvas.height/2;
        let ang = Math.atan2(state.worldY - en.y, state.worldX - en.x);
        en.x += Math.cos(ang) * 1.6; en.y += Math.sin(ang) * 1.6;

        ctx.strokeStyle = '#ff0044'; ctx.lineWidth = 3;
        ctx.save(); ctx.translate(sx, sy); ctx.rotate(ang + Math.PI);
        ctx.beginPath(); ctx.moveTo(en.size/2, 0); ctx.lineTo(-en.size/2, -en.size/2); ctx.lineTo(-en.size/2, en.size/2); ctx.closePath(); ctx.stroke();
        ctx.restore();

        if(Date.now() - en.lastShot > 2000 && Math.hypot(sx-canvas.width/2, sy-canvas.height/2) < 600) {
            lasers.push({ x: sx, y: sy, vx: Math.cos(ang)*11, vy: Math.sin(ang)*11, life: 90, owner: 'enemy', size: 4, color: 'red', damage: en.laserDmg });
            en.lastShot = Date.now();
        }

        lasers.forEach(l => {
            if(l.owner === 'player' && Math.abs(sx-l.x) < en.size/2 && Math.abs(sy-l.y) < en.size/2) {
                en.hp -= l.damage; l.life = 0;
                if(en.hp <= 0) { state.money += 400; createExplosion(sx, sy, 'red', 20); enemies.splice(i, 1); }
            }
        });
    });

    lasers.forEach((l, i) => {
        l.x += l.vx; l.y += l.vy; l.life--;
        ctx.fillStyle = l.color; ctx.fillRect(l.x - l.size/2, l.y - l.size/2, l.size, l.size);
        if(l.owner === 'enemy' && Math.abs(l.x - canvas.width/2) < 25 && Math.abs(l.y - canvas.height/2) < 25) {
            if(state.shield > 0) state.shield -= l.damage; else state.hp -= l.damage;
            state.lastHit = Date.now(); l.life = 0;
            if(state.hp <= 0) { alert("SCHIFF KRITISCH BESCHÄDIGT!"); location.reload(); }
        }
        if(l.life <= 0) lasers.splice(i, 1);
    });
}

function updateShopUI() {
    const grid = document.getElementById('shipGrid');
    grid.innerHTML = '';
    ships.forEach((s, index) => {
        const isOwned = state.ownedShips.includes(s.id);
        const isActive = state.shipType === index;
        const canAfford = state.money >= s.price;
        let card = document.createElement('div');
        card.className = `card ${isActive ? 'active' : ''} ${(!isOwned && !canAfford) ? 'locked' : ''}`;
        card.innerHTML = `<h3 style="color:${s.color}; font-size:14px;">${s.name}</h3><p style="font-size:10px; color:#777">HP: ${s.hp} | ATK: ${s.laser}</p><p style="color:var(--gold); font-size:12px; margin-top:5px;">${isOwned ? (isActive ? "SYSTEM AKTIV" : "REAKTIVIEREN") : s.price + " CR"}</p>`;
        card.onclick = () => {
            if(isOwned) { state.shipType = index; state.maxHp = s.hp; state.hp = Math.min(state.hp, s.hp); updateShopUI(); }
            else if(canAfford) { state.money -= s.price; state.ownedShips.push(s.id); state.shipType = index; state.maxHp = s.hp; state.hp = s.hp; state.shield = 100; updateShopUI(); }
        };
        grid.appendChild(card);
    });
}

function buyRepair() { if(state.money >= 450 && state.hp < state.maxHp) { state.money -= 450; state.hp = Math.min(state.maxHp, state.hp + 40); updateUI(); } }
function buyShieldUpgrade() { if(state.money >= 2500) { state.money -= 2500; state.shieldRegenRate += 0.05; updateUI(); } }
function toggleShop() { state.isPaused = !state.isPaused; document.getElementById('shopScreen').style.display = state.isPaused ? 'flex' : 'none'; if(state.isPaused) updateShopUI(); }

function createExplosion(x, y, color, count) { for(let i=0; i<count; i++) particles.push({ x, y, vx: (Math.random()-0.5)*8, vy: (Math.random()-0.5)*8, life: 30, color }); }
function drawStars() { stars.forEach(s => { let x = (s.x - state.worldX * s.depth) % canvas.width; let y = (s.y - state.worldY * s.depth) % canvas.height; if(x < 0) x += canvas.width; if(y < 0) y += canvas.height; ctx.fillStyle = `rgba(255,255,255,${s.depth})`; ctx.fillRect(x, y, s.size, s.size); }); }
function drawParticles() { particles.forEach((p, i) => { p.x += p.vx; p.y += p.vy; p.life--; ctx.fillStyle = p.color; ctx.globalAlpha = p.life/30; ctx.fillRect(p.x, p.y, 2, 2); if(p.life <= 0) particles.splice(i, 1); }); ctx.globalAlpha = 1; }
function updateRadar() { rctx.clearRect(0,0,160,160); rctx.fillStyle = 'white'; rctx.fillRect(79, 79, 2, 2); asteroids.forEach(a => { let rx = (a.x - state.worldX)/20, ry = (a.y - state.worldY)/20; if(Math.hypot(rx, ry) < 75) { rctx.fillStyle = '#333'; rctx.fillRect(80+rx, 80+ry, 2, 2); } }); enemies.forEach(e => { let rx = (e.x - state.worldX)/20, ry = (e.y - state.worldY)/20; if(Math.hypot(rx, ry) < 75) { rctx.fillStyle = 'red'; rctx.fillRect(80+rx, 80+ry, 3, 3); } }); }
function updateUI() { document.getElementById('moneyText').innerText = Math.floor(state.money); document.getElementById('hpFill').style.width = (state.hp/state.maxHp*100) + "%"; document.getElementById('shieldFill').style.width = state.shield + "%"; }

window.onkeydown = e => { keys[e.key.toLowerCase()] = true; if(e.key.toLowerCase() === 'm') toggleShop(); };
window.onkeyup = e => keys[e.key.toLowerCase()] = false;
window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
init();
</script>
</body>
</html>